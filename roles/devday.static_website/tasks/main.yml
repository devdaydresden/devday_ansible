---

- name: Log into ghcr.io
  community.docker.docker_login:
    registry_url: "ghcr.io"
    username: "{{ ghcr_registry_user }}"
    password: "{{ ghcr_registry_access_token }}"
    reauthorize: true

- name: website nginx container
  community.docker.docker_container:
    name: devday-static-website
    image: "{{ devday_static_website_image|default('ghcr.io/devdaydresden/devday_static_website') }}:{{ devday_static_website_version|default('latest') }}"
    platform: linux/amd64
    restart_policy: unless-stopped
    labels:
      traefik.enable: "true"
      traefik.docker.network: website_net
      traefik.http.routers.static-website.service: static-website
      traefik.http.routers.static-website.rule: "Host(`{{ devday_website_fqdn|default('localhost') }}`)"
      traefik.http.routers.static-website.tls: "true"
      traefik.http.routers.static-website.tls.domains: "{{ devday_website_fqdn|default('localhost') }}"
      traefik.http.routers.static-website.tls.certResolver: "myresolver"
      traefik.http.services.static-website.loadbalancer.server.port: "80"
      traefik.http.services.static-website.loadbalancer.passhostheader: "true"
